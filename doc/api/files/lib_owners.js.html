<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib\owners.js - EeeZorBot API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EeeZorBot API" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/api.html">api</a></li>
                                <li><a href="../classes/Channel.html">Channel</a></li>
                                <li><a href="../classes/debug.html">debug</a></li>
                                <li><a href="../classes/Listdb.html">Listdb</a></li>
                                <li><a href="../classes/log.html">log</a></li>
                                <li><a href="../classes/owners.html">owners</a></li>
                                <li><a href="../classes/Script.html">Script</a></li>
                                <li><a href="../classes/server.html">server</a></li>
                                <li><a href="../classes/stdin.html">stdin</a></li>
                                <li><a href="../classes/tools.html">tools</a></li>
                                <li><a href="../classes/User.html">User</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/api.html">api</a></li>
                                <li><a href="../modules/channel.html">channel</a></li>
                                <li><a href="../modules/debug.html">debug</a></li>
                                <li><a href="../modules/listdb.html">listdb</a></li>
                                <li><a href="../modules/log.html">log</a></li>
                                <li><a href="../modules/owners.html">owners</a></li>
                                <li><a href="../modules/script.html">script</a></li>
                                <li><a href="../modules/server.html">server</a></li>
                                <li><a href="../modules/stdin.html">stdin</a></li>
                                <li><a href="../modules/tools.html">tools</a></li>
                                <li><a href="../modules/user.html">user</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: lib\owners.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var storage = require(&#x27;node-persist&#x27;),
	tools = require(&#x27;./tools.js&#x27;);
storage.initSync({
	dir: &#x27;owners/&#x27;
});
/**
 * Owners class
 * @module owners
 * @class owners
 * @static
 */
module.exports = (function(){
	var self = this,
		owners;
	/**
	 * Returns all the owners
	 * @method values
	 * @return {Map} owners
	 */
	self.values = function(){
		self.fetch();
		return owners;
	};
	/**
	 * The number of owners stored
	 * @type {Number}
	 * @property length
	 * @static
	 */
	Object.defineProperty(self,&#x27;length&#x27;,{
		enumerable: true,
		get: function(){
			self.fetch();
			var i,
				c=0;
			for(i in owners){
				c++;
			}
			return c;
		}
	});
	/**
	 * Fetch the current state of the object
	 * @method fetch
	 * @chainable
	 */
	self.fetch = function(){
		owners = storage.getItem(&#x27;owners&#x27;);
		return self;
	};
	/**
	 * Flushes changes to the object
	 * @method flush
	 * @chainable
	 */
	self.flush = function(){
		storage.setItem(&#x27;owners&#x27;,owners);
		return self;
	};
	/**
	 * Gets a owner object
	 * @param  {String} nick nick that the owner is registered under
	 * @return {Map} The owner object
	 */
	self.get = function(nick){
		self.fetch();
		return owners[nick];
	};
	/**
	 * Adds or updates a owner
	 * @method add
	 * @param {String} nick The nick that the owner is registered under
	 * @param {Map} options parameters to store on the owner
	 * @chainable
	 */
	self.add = function(nick,options){
		self.fetch();
		var owner = owners[nick],
			i;
		if(owner === undefined){
			owner = {
				nick: nick,
				hostmasks: [],
				flags: &#x27;v&#x27;
			};
		}
		for(i in options){
			owner[i] = options[i];
		}
		owners[nick] = owner;
		self.flush();
		return self;
	};
	/**
	 * Removes a owner from the object
	 * @method remove
	 * @param  {String} nick The nick that the owner is registered under
	 * @chainable
	 */
	self.remove = function(nick){
		self.fetch();
		var o = {},
			i;
		for(i in owners){
			if(i != nick){
				o[i] = owners[i];
			}
		}
		owners = o;
		self.flush();
		return self;
	};
	/**
	 * Adds a hostmask to a owner
	 * @method addHostMask
	 * @param {String} nick     The nick the owner is registered under
	 * @param {String} hostmask The hostmask to add to the owner
	 * @chainable
	 */
	self.addHostMask = function(nick,hostmask){
		if(self.match(hostmask) === undefined){
			var owner = owners[nick];
			if(owner === undefined){
				self.add(nick);
				owner = owners[nick];
			}
			owner.hostmasks.push(hostmask);
			owners[nick] = owner;
			self.flush();
		}
		return self;
	};
	/**
	 * Remove a hostmask from a owner
	 * @param  {String} nick     The nick the owner is registered under
	 * @param  {String} hostmask The hostmask to remove from the owner
	 * @chainable
	 */
	self.removeHostMask = function(hostmask){
		var owner = self.match(hostmask),
			i;
		if(owner !== undefined){
			for(i=0;i&lt;owner.hostmasks.length;i++){
				if(owner.hostmasks[i] == hostmask){
					owner.hostmasks.splice(i,1);
				}
			}
			owners[owner.nick] = owner;
		}
		self.flush();
		return self;
	};
	/**
	 * Returns the owner who matches the hostmask
	 * @param  {String} hostmask Hostmask to search for.
	 * @return {Object}          owner who matched the hostmask, undefined if none found.
	 */
	self.match = function(hostmask){
		self.fetch();
		var owner,
			i,
			ii,
			iii,
			h;
		for(i in owners){
			owner = owners[i];
			for(ii=0;ii&lt;owner.hostmasks.length;ii++){
				h = owner.hostmasks[ii];
				if(h.indexOf(&#x27;*&#x27;) != -1){
					var s = tools.wildcardString(h);
					if(hostmask.search(new RegExp(s)) != -1){
						return owner;
					}
				}else if(h == hostmask){
					return owner;
				}
			}
		}
	};
	self.fetch();
	if(owners === undefined){
		owners = {};
		self.flush();
	}
	return self;
})();
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
